import{h as e}from"./vendor.24928e26.js";class t{constructor(){this._seed=""}get(t){return this._seed===t&&this._noise||(this._noise=new e(t),this._seed=t),this._noise}}const a=self;function n({gen:e,ctx:t,rpm:a}){const n=e.get(a.seed);let s={ctx:t,noiseFn:function(e,t){return n.noise3D(e/10,t/10,1)},params:a.genParams};t.clearRect(0,0,t.canvas.width,t.canvas.height);let i=function(e){const{ctx:t,noiseFn:a,params:{n1:n,n2:s,distortion:i,dotDiameter:o}}=e;let r=-20,c=o/2,d=t.canvas.width,l=t.canvas.height,h=new Path2D;for(let g=r;g<l-r;g++)for(let e=r;e<d-r;e++){let t=e*(o+1)+0+.5+c,r=g*(o+1)+0+.5+c,d=t+i*a(t/n,r/s),l=r+i*a(t/s,r/n);h.rect(d,l,1,1)}return[h]}(s);t.fillStyle=a.color,t.fill(i[0])}!function(){let e,s,i=new t,o=new t,r={};a.onmessage=t=>{if("init"===t.data.type)return e=t.data.canvas,void(s=e.getContext("2d"));if(s)if("run"===t.data.type&&t.data.canvasWidth&&t.data.canvasHeight&&(s.canvas.width=t.data.canvasWidth,s.canvas.height=t.data.canvasHeight),s.canvas.width&&s.canvas.height||"get-preview-id"===t.data.type)switch(t.data.type){case"run":r=t.data.renderParams,n({gen:i,ctx:s,rpm:r});break;case"get-preview":{let n=t.data.smallWidth,s=t.data.smallHeight;const i=new OffscreenCanvas(n,s),o=i.getContext("2d");if(o){let t=Math.min(e.width,e.height);o.drawImage(e,0,0,t,t,0,0,n,s),i.convertToBlob().then((function(e){a.postMessage({type:"preview-blob",blob:e,renderParams:r})}))}break}case"get-preview-id":{const e=t.data;let s=Math.min(e.largeWidth,e.largeHeight);const i=new OffscreenCanvas(e.largeWidth,e.largeHeight),r=i.getContext("2d"),c=new OffscreenCanvas(e.smallWidth,e.smallHeight),d=c.getContext("2d");r&&d&&(n({gen:o,ctx:r,rpm:e.renderParams}),d.drawImage(i,0,0,s,s,0,0,e.smallWidth,e.smallHeight),c.convertToBlob().then((function(t){a.postMessage({type:"preview-blob-id",blob:t,id:e.id,renderParams:e.renderParams})})));break}case"get-image":{const n=t.data.promiseId;e.convertToBlob({quality:1}).then((function(e){a.postMessage({type:"got-image",blob:e,resolveId:n})}));break}}else console.log("no canvas size yet");else console.log("no ctx yet")}}();
